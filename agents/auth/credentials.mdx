---
title: "Credentials"
description: "Securely store login credentials for automated re-authentication"
---

Credentials allow you to securely store login information that enables fully automated authentication flows. When linked to an Auth Agent, credentials enable automatic re-authentication when sessions expire—without any user interaction.

## Why Use Credentials?

Without stored credentials, every time a session expires, you need to redirect users back through the login flow. With credentials:

- **Automated re-auth** - Sessions can be refreshed automatically in the background
- **No user interaction** - Re-authentication happens without user involvement
- **Encrypted at rest** - Values encrypted with per-organization keys, never stored in plaintext
- **Never exposed** - Submitted programmatically to target sites, never passed to LLMs or returned in API responses

## How Credentials Work

<Steps>
  <Step title="Store Credentials">
    ```typescript
    const credential = await kernel.credentials.create({
      name: 'my-login',
      domain: 'example.com',
      values: { email: 'user@example.com', password: 'secret' },
      totp_secret: 'JBSWY3DPEHPK3PXP',  // Optional: for sites with authenticator-based 2FA
    });
    ```
  </Step>
  <Step title="Link to Auth Agent">
    ```typescript
    const agent = await kernel.agents.auth.create({
      domain: 'example.com',
      profile_name: 'my-profile',
      credential_name: 'my-login',
    });
    ```
  </Step>
  <Step title="Complete Initial Login">
    Run one successful authentication to save form selectors (via [Auto-Login](/agents/auth/auto-login) or [Hosted UI](/agents/auth/hosted-ui)).
  </Step>
  <Step title="Automatic Re-auth">
    With complete credentials, re-authentication happens automatically when sessions expire—no code required.
  </Step>
</Steps>

## Creating Credentials

Store credentials using the Credentials API. Values are encrypted immediately and cannot be retrieved.

<CodeGroup>
```typescript TypeScript
import Kernel from '@onkernel/sdk';

const kernel = new Kernel();

// Create a credential
const credential = await kernel.credentials.create({
  name: 'my-netflix-login',           // Unique name within your org
  domain: 'netflix.com',              // Target domain
  values: {                           // Key-value pairs of login fields
    email: 'user@example.com',
    password: 'secretpassword123',
  },
});

console.log('Credential created:', credential.id);
// Note: values are NOT returned - only metadata
```

```python Python
from kernel import Kernel

kernel = Kernel()

# Create a credential
credential = await kernel.credentials.create(
    name="my-netflix-login",
    domain="netflix.com",
    values={
        "email": "user@example.com",
        "password": "secretpassword123",
    },
)

print(f"Credential created: {credential.id}")
```
</CodeGroup>

**Parameters:**

| Parameter | Required | Description |
|-----------|----------|-------------|
| `name` | Yes | Unique name for the credential within your organization |
| `domain` | Yes | Target domain this credential is for (e.g., `netflix.com`) |
| `values` | Yes | Object containing field name → value pairs |
| `totp_secret` | No | Base32-encoded TOTP secret for automatic 2FA code generation |
| `sso_provider` | No | SSO provider name (e.g., `google`, `github`, `microsoft`). When set, clicks matching SSO button automatically. |

<Warning>
Credential values are write-only. Once stored, they cannot be retrieved via the API. Only metadata (id, name, domain, created_at, updated_at, has_totp_secret) is returned.
</Warning>

## Linking Credentials to Auth Agents

There are two ways to link credentials to an Auth Agent:

### Option 1: Link During Auth Agent Creation

```typescript
// Create auth agent with credential link
const agent = await kernel.agents.auth.create({
  domain: 'netflix.com',
  profile_name: 'my-profile',
  credential_name: credential.name,  // Link the credential
});
```

### Option 2: Save Credentials During Auth Flow

During an authentication invocation, you can save the entered credentials:

```typescript
const invocation = await kernel.agents.auth.invocations.create({
  auth_agent_id: agent.id,
  save_credential_as: 'my-netflix-login',  // Save credentials when login succeeds
});
```

This approach:
- Creates the credential automatically when login succeeds (or updates if it already exists)
- Links it to the Auth Agent
- Saves the form selectors for future re-auth

#### Updating Existing Credentials

If you use `save_credential_as` with the name of an existing credential, the submitted values are **merged** into that credential:

```typescript
// 1. Create credential with just the identifier
const credential = await kernel.credentials.create({
  name: 'my-login',
  domain: 'example.com',
  values: { email: 'user@example.com' },  // No password yet
});

// 2. Create agent with the credential linked
const agent = await kernel.agents.auth.create({
  domain: 'example.com',
  profile_name: 'my-profile',
  credential_name: 'my-login',
});

// 3. During login, user provides the password manually
// Using save_credential_as with the SAME name updates the credential
const invocation = await kernel.agents.auth.invocations.create({
  auth_agent_id: agent.id,
  save_credential_as: 'my-login',  // Same name as linked credential
});

// After successful login:
// - The credential now has BOTH email AND password
// - Future re-auth can use both values automatically
```

This is useful when:
- You have partial credentials (e.g., identifier only) and want to capture the password during login
- Users change their password and you want to save the new one
- You want to progressively build up credential values across multiple logins

<Note>
TOTP codes are never saved to credentials—they're one-time codes generated from the TOTP secret.
</Note>

## Using Stored Credentials

Once credentials are linked and an initial login has completed (capturing form selectors), the Auth Agent can re-authenticate automatically when sessions expire—no code required.

An Auth Agent can auto re-auth (`can_reauth: true`) when:
1. It has a linked credential (`credential_id` is set)
2. It has saved form selectors from a previous successful login (`has_selectors` is true)

See [Session Monitoring](/agents/auth/session-monitoring) for details on how automatic re-authentication works.

## Managing Credentials

### List Credentials

```typescript
const credentials = await kernel.credentials.list({
  domain: 'netflix.com',  // Optional: filter by domain
});

for (const cred of credentials) {
  console.log(`${cred.name} (${cred.domain}) - Created: ${cred.created_at}`);
}
```

### Get Credential Details

```typescript
// Retrieve by ID or name
const credential = await kernel.credentials.retrieve('my-netflix-login');

console.log('Name:', credential.name);
console.log('Domain:', credential.domain);
console.log('Created:', credential.created_at);
console.log('Updated:', credential.updated_at);
// Note: values are never returned
```

### Update Credentials

```typescript
// Update by ID or name
await kernel.credentials.update('my-netflix-login', {
  name: 'updated-name',  // Optional: update name
  values: {              // Optional: update values
    email: 'newemail@example.com',
    password: 'newpassword',
  },
});
```

### Delete Credentials

```typescript
// Delete by ID or name
await kernel.credentials.delete('my-netflix-login');
```

<Warning>
Deleting a credential unlinks it from any associated Auth Agents. Those agents will no longer be able to re-authenticate automatically.
</Warning>

## Credential Values Schema

The `values` object is flexible—it stores whatever key-value pairs you provide. Common patterns:

### Basic Email/Password

```typescript
values: {
  email: 'user@example.com',
  password: 'secretpassword',
}
```

### Username/Password

```typescript
values: {
  username: 'myusername',
  password: 'secretpassword',
}
```

### With TOTP-based 2FA

For sites that use authenticator apps (Google Authenticator, Authy, 1Password, etc.) for two-factor authentication, you can provide the TOTP secret to enable fully automated login—including the 2FA step.

```typescript
const credential = await kernel.credentials.create({
  name: 'my-login',
  domain: 'example.com',
  values: {
    email: 'user@example.com',
    password: 'secretpassword',
  },
  totp_secret: 'JBSWY3DPEHPK3PXP',  // Base32-encoded TOTP secret
});
```

When the Auth Agent detects a 2FA code field during login, it automatically generates the current 6-digit code using the provided secret—no manual intervention required.

#### What is a TOTP Secret?

A TOTP (Time-based One-Time Password) secret is a base32-encoded key shared between you and the target site. It's the same secret your authenticator app uses to generate 6-digit codes that change every 30 seconds.

#### How to Obtain Your TOTP Secret

1. Go to the target site's security or 2FA settings
2. Choose "Set up authenticator app" (or re-setup if already configured)
3. Look for a link like "Can't scan the code?" or "Enter manually"
4. Copy the text secret shown (e.g., `JBSW Y3DP EHPK 3PXP`)
5. Remove any spaces and use it as the `totp_secret`

#### Completing 2FA Setup with Kernel

When setting up 2FA on a site, you typically need to enter a verification code to confirm the setup. When you store your TOTP secret in Kernel, we return the current code so you can complete setup immediately:

```typescript
// Create credential with TOTP secret
const credential = await kernel.credentials.create({
  name: 'my-login',
  domain: 'example.com',
  values: { email: 'user@example.com', password: 'secret' },
  totp_secret: 'JBSWY3DPEHPK3PXP',
});

// Use the returned code to complete 2FA setup on the site
console.log('Enter this code:', credential.totp_code);           // e.g., "847291"
console.log('Expires at:', credential.totp_code_expires_at);     // ISO 8601 timestamp
```

If you need a fresh code later (e.g., for manual login or the first code expired), use the TOTP code endpoint:

```typescript
// Get TOTP code by ID or name
const { code, expires_at } = await kernel.credentials.totpCode('my-login');
console.log('Current code:', code);  // Fresh 6-digit code
```

This means you can store your TOTP secrets **only in Kernel**—no need to also add them to a personal authenticator app.

<Warning>
Store your TOTP secret securely. If you only configure the authenticator app by scanning the QR code, you may not have access to the text secret later.
</Warning>

### With SSO Provider (OAuth)

For sites that support "Sign in with Google/GitHub/Microsoft" buttons, you can use the `sso_provider` field to automate OAuth login flows. When set, the workflow automatically clicks the matching SSO button and fills your credentials on the identity provider's login page.

```typescript
const credential = await kernel.credentials.create({
  name: 'my-google-sso-login',
  domain: 'example.com',  // Can be the main site or the IdP domain
  values: {
    email: 'user@gmail.com',
    password: 'google-account-password',
  },
  sso_provider: 'google',  // Clicks "Continue with Google" button
});
```

**How it works:**
1. The workflow discovers the login page and finds SSO buttons
2. It clicks the button matching your `sso_provider` (e.g., "Continue with Google")
3. After redirecting to the IdP (e.g., accounts.google.com), it fills your credentials
4. Completes the OAuth flow and returns to the original site, logged in

**Important:** When using SSO, you must include the IdP domain in `allowed_domains` on the auth agent:

```typescript
const agent = await kernel.agents.auth.create({
  domain: 'example.com',
  profile_name: 'my-profile',
  credential_name: 'my-google-sso-login',
  allowed_domains: ['accounts.google.com', 'google.com'],  // Required for Google SSO
});
```

<Note>
The `sso_provider` value should match the provider name in the SSO button (e.g., `google`, `github`, `microsoft`, `okta`, `apple`). The matching is case-insensitive.
</Note>

#### Supported 2FA Types

| Type | Auto-Login | User-Facing | Notes |
|------|------------|-------------|-------|
| **TOTP (Authenticator apps)** | ✅ | ✅ | Automated with `totp_secret`, or enter manually |
| **SMS OTP** | ❌ | ✅ | User receives text and enters code via UI |
| **Email OTP** | ❌ | ✅ | User receives email and enters code via UI |
| **Push notifications** | ❌ | ❌ | Not yet supported |
| **Hardware keys (FIDO/U2F)** | ❌ | ❌ | Requires physical connection to browser machine |

- **Auto-Login**: Fully automated with stored credentials, no user present
- **User-Facing**: User enters values via [Hosted UI](/agents/auth/hosted-ui) or your [custom UI](/agents/auth/programmatic)

<Tip>
For SMS and email OTP, the field appears as a pending field. The user receives the code on their device, then enters it through your UI—no special configuration needed.
</Tip>

### Multiple Fields

Some sites have additional fields (company ID, account number, etc.):

```typescript
values: {
  company_id: 'ACME123',
  username: 'jsmith',
  password: 'secretpassword',
}
```

### Phone Number

For sites that require phone-based login:

```typescript
values: {
  phone: '+1234567890',
  password: 'secretpassword',
}
```

## Complete Example: Automated Auth Flow

Here's a complete example setting up fully automated authentication:

```typescript
import Kernel from '@onkernel/sdk';

const kernel = new Kernel();

// 1. Create credential (with optional TOTP secret for 2FA sites)
const credential = await kernel.credentials.create({
  name: 'acme-portal-login',
  domain: 'portal.acme.com',
  values: {
    email: 'agent@company.com',
    password: 'secure-password-123',
  },
  totp_secret: 'JBSWY3DPEHPK3PXP', // Optional: for fully automated 2FA
});

// 2. Create auth agent with credential linked
const agent = await kernel.agents.auth.create({
  domain: 'portal.acme.com',
  profile_name: 'acme-agent-profile',
  credential_name: credential.name,
  login_url: 'https://portal.acme.com/login',
});

// 3. Complete initial login to capture form selectors
const invocation = await kernel.agents.auth.invocations.create({
  auth_agent_id: agent.id,
});

// Poll for completion or redirect user to hosted_url
// After success, agent.can_reauth will be true

// 4. Use the authenticated profile
const browser = await kernel.browsers.create({
  profile: { name: 'acme-agent-profile' },
  stealth: true,
});

// Browser is logged in! Run your automation...
```

Once set up, sessions are automatically refreshed when they expire. See [Session Monitoring](/agents/auth/session-monitoring) for details.

## Complete Example: SSO Login with Google

Here's a complete example using Google OAuth to log into a site:

```typescript
import Kernel from '@onkernel/sdk';

const kernel = new Kernel();

// 1. Create credential with SSO provider
const credential = await kernel.credentials.create({
  name: 'acme-google-login',
  domain: 'portal.acme.com',
  values: {
    email: 'agent@company.com',
    password: 'google-password',
  },
  sso_provider: 'google',  // Clicks "Continue with Google" automatically
  totp_secret: 'JBSWY3DPEHPK3PXP', // Optional: if Google account has 2FA
});

// 2. Create auth agent with allowed_domains for Google
const agent = await kernel.agents.auth.create({
  domain: 'portal.acme.com',
  profile_name: 'acme-agent-profile',
  credential_name: credential.name,
  allowed_domains: ['accounts.google.com', 'google.com'], // Required for Google SSO
});

// 3. Start invocation - SSO flow is fully automated
const invocation = await kernel.agents.auth.invocations.create({
  auth_agent_id: agent.id,
});

// 4. Poll for completion
let state = await kernel.agents.auth.invocations.retrieve(invocation.invocation_id);
while (state.status === 'IN_PROGRESS') {
  console.log(`Step: ${state.step}`);
  
  // Handle external action (e.g., Google push notification)
  if (state.step === 'awaiting_external_action') {
    console.log('Action required:', state.external_action_message);
    // User needs to approve on their phone, keep polling
  }
  
  await new Promise(r => setTimeout(r, 2000));
  state = await kernel.agents.auth.invocations.retrieve(invocation.invocation_id);
}

if (state.status === 'SUCCESS') {
  console.log('SSO login successful!');
}

// 5. Use the authenticated profile
const browser = await kernel.browsers.create({
  profile: { name: 'acme-agent-profile' },
  stealth: true,
});
```

## Security

Credentials are designed with security as the top priority:

| Security Feature | Description |
|-----------------|-------------|
| **Encryption at rest** | All credential values and TOTP secrets are encrypted using per-organization keys |
| **Write-only values** | Values and TOTP secrets cannot be retrieved via the API after creation |
| **Never logged** | Credential values and TOTP secrets are never written to logs |
| **Never exposed** | Values are injected directly into form fields, never returned in API responses |
| **No LLM exposure** | Credentials submitted programmatically to target sites, never passed to LLMs |
| **Isolated execution** | Each auth flow runs in an isolated browser environment |
| **TOTP status only** | API only returns `has_totp_secret` (boolean), never the secret itself |
| **Ephemeral TOTP codes** | Generated codes expire every 30 seconds and are only returned when needed |

## Best Practices

1. **Use descriptive names** - Name credentials clearly (e.g., `production-crm-login`, `staging-portal-admin`)

2. **One credential per account** - Create separate credentials for different user accounts

3. **Monitor auth status** - Use [Session Monitoring](/agents/auth/session-monitoring) to detect when re-auth is needed

4. **Handle re-auth failures** - If automated re-auth fails (password changed, new 2FA method), fall back to a user-facing flow

## Next Steps

<CardGroup cols={2}>
  <Card title="Auto-Login" icon="bolt" href="/agents/auth/auto-login">
    Fully automated login with pre-linked credentials
  </Card>
  <Card title="Session Monitoring" icon="clock" href="/agents/auth/session-monitoring">
    Automatic session health checks and re-auth
  </Card>
</CardGroup>
